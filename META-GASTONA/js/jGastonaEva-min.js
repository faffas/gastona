/*
jGastonaEva-min.js = minify Eva.js + EvaLayout.js + LayoutManager.js + jGastona.js
part of open source project https://github.com/wakeupthecat/gastona

Copyright (C) 2015,2016 Alejandro Xalabarder Aulet
License : GNU General Public License (GPL) version 3

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.
*/
function evaFileObj(t){function e(t){var e,a="";for(e in t)a+="\n#"+e+"#\n",a+=n(t[e]);return a}function n(t){var e,n="";for(e in t)n+="\n   <"+e+">\n",n+=a(t[e]);return n}function a(t){var e="";for(var n in t){e+="      ";for(var a in t[n])a>0&&(e+=", "),a==t[n].length-1&&(e+="//"),e+=t[n][a];e+="\n"}return e}return"string"==typeof t&&(t=evaFileStr2obj(t)),{obj:t,toText:function(){return e(t)},toString:function(){return e(t)},evaFileObj2Text:e,evaUnitObj2Text:n,evaObj2Text:a}}function evaFile(t){alert("evaFile function name is deprecated! please use evaFileStr2obj instead"),evaFileStr2obj(t)}function evaFileUTF82obj(t){return evaFileStr2obj(decodeURIComponent(t.replace(/\+/g,"%20")))}function evaFileStr2obj(t){function e(t,e,n,a){return 0==t.indexOf(e)?(a=t.indexOf(n,1),a>0?{name:t.substr(1,a-1),rest:t.substr(a+1).trim()}:void 0):void 0}function n(t,e,n,a){if(t=t.trim(),e=t.length,0!=e){if(0==t.indexOf("'"))return[t.substr(1)];if(0==t.indexOf("//"))return[t.substr(2)];t.lastIndexOf(",")==e-1&&(t=t.substring(0,e-1)),n=t.split(",");for(a in n)n[a]=decodeURIComponent(n[a].trim());return n}}function a(t){function a(t){o&&(f[o]=g),o=void 0,g=[],t&&(i&&(c[i]=f),i=void 0,f=[])}var i,o,r,d,s,u,l,c={},f={},g=[],s=t;"string"==typeof t&&(s=t.split("\n"));for(l in s)d=s[l].trim(),r=e(d,"#","#"),r?(a(!0),i=r.name):(r=e(d,"<",">"),r&&(a(!1),o=r.name,d=r.rest,0==d.length)||i&&o&&(u=n(d),u&&g.push(u)));return a(!0),c}return"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a(t)}function EvaLayout(t,e){function n(t,e){function n(t){var e=s,n=0,a=0;return t+="",0==t.length||0==t.indexOf("A")?e=s:0==t.indexOf("X")?(e=u,n=t.length<2?1:parseInt(t.substr(1))):(e=d,a=parseInt(t)),{type:e,len:a,extraPercent:n}}function a(t,e){e=n(t||""),f.push(e),l+=e.extraPercent}function i(t,e){f[t]&&f[t].type==s&&(f[t].len=Math.max(f[t].len,e))}function o(n,a){c=t+t+e*(f.length-1);for(n in f)a=f[n],c+=a.len,l>0&&(a.extraPercent=a.extraPercent/l)}function r(t,n,a,i){for(i=0,a=a||n;(a>=n||-1==a)&&n<f.length;n++)i+=e+f[n].len+f[n].extraPercent*t;return i}var d=0,s=1,u=2,l=0,c=0,f=[];return{margin:t,gap:e,fixedSize:function(){return c},regla:f,addItem:a,setLengthOfItemAt:i,endItems:o,getLengthInRange:r,countItems:function(){return f.length}}}function a(t){return v[1][t+1]}function i(t){return v[2+t][0]}function o(){return v.length-2}function r(t){return v[2+t].length-1}function d(t,e){return t+=2,e+=1,t>=0&&t<v.length&&e>=0&&e<v[t].length?v[t][e]:void 0}function s(){if(!g){c=n(parseInt(v[0][1])||0,parseInt(v[0][3])||0),f=n(parseInt(v[0][2])||0,parseInt(v[0][4])||0);for(var e=0,s=o(),u=0;s>u;u++){e=r(u),f.addItem(i(u));for(var l=0;e>l;l++){l<c.countItems()||c.addItem(a(l));var m=d(u,l);if(m&&t.cellElementIsAnId(m)){var h=t.getLayableByName(m);if(h){h.indxPos.ileft=l,h.indxPos.itop=u;for(var y=l;e>y+1&&d(u,y+1)===t.EXPAND_HORIZONTAL;)y++;for(e>y+1&&d(u,y+1)===t.EXPAND_HORIZONTAL+t.EXPAND_HORIZONTAL&&(y=-1),h.indxPos.iright=y,y==l&&c.setLengthOfItemAt(l,h.iniRect.right-h.iniRect.left),y=u;s>y+1&&d(y+1,l)===t.EXPAND_VERTICAL;)y++;s>y+1&&d(y+1,l)===t.EXPAND_VERTICAL+t.EXPAND_VERTICAL&&(y=-1),h.indxPos.ibottom=y,y==u&&f.setLengthOfItemAt(u,h.iniRect.bottom-h.iniRect.top),h.isLaidOut=!0}}}}c.endItems(),f.endItems(),p.top=0,p.bottom=f.fixedSize(),p.left=0,p.right=c.fixedSize(),g=!0}}function u(e,n,a,i){s();for(var o=i-f.fixedSize(),r=a-c.fixedSize(),u=e+c.margin,l=0;l<c.countItems();l++){l>0&&(u+=c.getLengthInRange(r,l-1));for(var g=n+f.margin,v=0;v<f.countItems();v++){v>0&&(g+=f.getLengthInRange(o,v-1));var p=d(v,l);if(p){var m=t.getLayableByName(p);if(m)if(m.isLaidOut){var h=-c.gap,y=-f.gap;if(h+=c.getLengthInRange(r,m.indxPos.ileft,m.indxPos.iright),y+=f.getLengthInRange(o,m.indxPos.itop,m.indxPos.ibottom),0>u||0>g||0>h||0>y)continue;m.doMove(u,g,h,y),m.doShow(!0)}else m.doShow(!1)}}}}function l(e){s();for(var n=0;n<c.countItems();n++)for(var a=0;a<f.countItems();a++){var i=t.getLayableByName(d(a,n));i&&i.doShow(e)}}var c,f,g=!1,v=t.guiLayouts[e],p={left:0,right:200,top:0,bottom:20},m={ileft:0,iright:0,itop:0,ibottom:0};return v?v[0][0].match(/^eva$|^evalayout$/i)?{precalculateLayout:s,wName:e,isLaidOut:!1,iniRect:p,indxPos:m,invalidate:function(){g=!1},isWidget:!1,doMove:u,doShow:l}:void 0:void console.log('ERROR: no eva found with name "'+e+'"')}function layoutManager(t,e){function n(t,e,n){for(n in t)if(t[n]===e)return console.log("ERROR: layout element "+e+" already exists, it cannot be stacked!"),!1;return!0}function a(t){b&&b===t||i(),b=t}function i(t,e){for(e in y)t=y[e],t.isWidget?t.doShow(!1):t.invalidate()}function o(t,e){return{wName:t,isLaidOut:!1,iniRect:e||{left:0,right:200,top:0,bottom:20},indxPos:{ileft:0,iright:0,itop:0,ibottom:0},isWidget:!0,doMove:function(e,n,a,i){var o=document.getElementById(t);o?(o.style.position="absolute",o.style.left=Math.round(e)+"px",o.style.top=Math.round(n)+"px",o.style.width=Math.round(a)+"px",o.style.height=Math.round(i)+"px"):console.log("ERROR expected html element "+t+" not found!")},doShow:function(e){var n=document.getElementById(t);n&&(n.style.visibility=e?"visible":"hidden")}}}function r(t){if(""!==t){var e=y[u(t)];return e?(n(x,e.wName)&&(e.isWidget||e.precalculateLayout()),e):(console.log("ERROR: don't know how to find "+t+" or "+u(t)),o("bDummy"))}}function d(t,e){h[t]=e&&""!==e&&t!==e?e:void 0,m=!0,i()}function s(t){h[t]=void 0,m=!0,i()}function u(t){var e,n,a=[];do{if(e=h[t],!e||""===e||e===t)return t;for(n in a)if(a[n]===e)return console.log("ERROR: masks for "+t+" found circular!"),t;a.push(t),t=e}while(a.length<200);return console.log("ERROR: masks for "+t+" too deep!"),t}function l(t){return t&&t.length>0&&0!=t.indexOf(I)&&0!=t.indexOf(R)}function c(){return{EXPAND_HORIZONTAL:R,EXPAND_VERTICAL:I,guiLayouts:v,guiConfig:p,getLayableByName:r,cellElementIsAnId:l}}function f(t){if(p={},v=t.layouts,!v){v={};var e=t.javaj;if(!e)return void console.log("Error: unit layouts not found!");for(var n in e)0==n.indexOf("layout of ")?v[n.substr(10)]=e[n]:p[n]=e[n]}m=!0,h={},x=[],y={};for(var a in v){var i=EvaLayout(c(),a);i&&(y[a]=i,console.log("adding layout id ["+a+"]"))}var n,r,d,s,u,f;for(a in v){n=v[a],d=n.length;for(var r=2;d>r;r++){u=n[r].length;for(var s=1;u>s;s++)f=n[r][s],l(f)&&(y[f]||(A(f),y[f]=o(f)))}}}function g(t,e,n,i,o){t=t||"main",a(t);var d=r(t);x.push(d.wName),d.doMove(e,n,i,o),x.pop()}var v,p,m,h,y,b,A=e||function(t){console.log("adding widget id ["+t+"]")},x=[],R="-",I="+";return f(t),{guiConfig:p,loadConfig:function(e){t=e,f(t)},maskLayoutId:d,unmaskLayoutId:s,doShowLayout:function(t,e,n){g(t,0,0,e,n)},setLayout:function(t){a(t)},doLayout:function(t,e){g(b,0,0,t,e)}}}function jGastona(evaConfig,existingPlaceId){function getWindowWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getWindowHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function adaptaLayout(){if(layMan){var t=getWindowWidth()-15,e=getWindowHeight()-15,n=layMan.guiConfig.layoutWindowLimits;if(n&&n[0]){var a=parseInt("0"|n[0][0]),i=parseInt("0"|n[0][1]),o=parseInt("0"|n[0][2]),r=parseInt("0"|n[0][3]);t=Math.max(t,a),e=Math.max(e,i),o>0&&(t=Math.min(t,o)),r>0&&(e=Math.min(e,r))}layMan&&layMan.doLayout(t,e)}}function loadJast(t){if(javajzWidgets={},responseAjaxUnit={},dataUnit={},listixUnit={},layMan=void 0,t){if(dataUnit=t.data||{},listixUnit=t.listix||{},!corpiny){var e=existingPlaceId?existingPlaceId:"jGastonaStammHtmlElem";document.getElementById(e)||(document.body.innerHTML="<div id='"+e+"' style = 'position:relative;'></div>"),corpiny=document.getElementById(e)}for(corpiny||alert("ERROR no "+e+" no fun!");corpiny.hasChildNodes();)corpiny.removeChild(corpiny.firstChild);layMan=layoutManager(t,onAddWidget),adaptaLayout()}}function getCellEvaUnit(t,e,n,a){return t[e]?t[e][n||"0"][a||"0"]||"":""}function getDataCell(t,e,n){return getCellEvaUnit(dataUnit,t,e,n)}function setDataCell(t,e,n,a){dataUnit[t]||(dataUnit[t]=[[""]]),dataUnit[t][n||"0"]||(dataUnit[t][n||"0"]=[""]),dataUnit[t][n||"0"][a||"0"]=e||""}function setData(t,e){"string"==typeof e?setDataCell(t,e):Array.isArray(e)&&e.length>0&&Array.isArray(e[0])?dataUnit[t]=e:alert('Error: setData "'+t+'", the value is not a string nor looks like an eva variable');var n=getzWidgetByName(t);n&&updatezWidget(n)}function mensaka(t){var e=t.indexOf(" ");if(e>0){var n=t.substr(0,e),a=t.substr(e+1);if(javajzWidgets[n])return void(javajzWidgets[n][a]?javajzWidgets[n][a]():console.log("Error: widget "+n+" has no method '"+a+"'"))}var i=dataUnit["-- "+t]||listixUnit["-- "+t];return i?void executeListixFormat(i):void console.log('ignoring mensaka "'+t+'"')}function executeListixFormat(fbody){var strBody="";for(var ii in fbody)strBody+=fbody[ii]+"\n";eval(strBody)}function setVarTable_DimVal(t){var e=[["dimension","value"]];for(var n in t)e.push([t[n],getDataCell(t[n])]);dataUnit.varTable_DimVal=e}function setValueToElement(t,e){t&&("string"==typeof t.value?t.value=e:t.innerHTML=e)}function onAddWidget(t){if(t&&0!=t.length){var e,n=function(){this.innerHTML=dataUnit[t]?getDataCell(t):t.substr(1)},a=function(){setValueToElement(this,getDataCell(t))},i=function(){this.value=""},o=function(){this.style["background-image"]="url('"+getDataCell(t)+"')"},r=function(){dataUnit[t][0]=[this.value||"?"]},d=function(){dataUnit[t]=[[]];var e=this.value||"?",n=e.split("\n");for(var a in n)dataUnit[t][a]=[n[a]]},s=function(){mensaka(t)},u=dataUnit["class of "+t],l=u?u[0][0]:t;switch(l.charAt(0)){case"d":e=fabricaStandard("div",t,{"data!":n});break;case"n":e=fabricaStandard("a",t,{href:"login","data!":n});break;case"b":e=fabricaStandard("button",t,{onclick:s,"data!":n});break;case"e":e=fabricaStandard("input",t,{type:"text",onchange:r,"data!":a});break;case"f":e=fabricaStandard("input",t,{type:"file",onchange:s,"data!":i});break;case"m":e=fabricaStandard("div",t,{"data!":o});break;case"p":e=fabricaStandard("input",t,{type:"password",onchange:r,"data!":a});break;case"l":e=fabricaStandard("label",t,{"data!":n});break;case"x":var c=function(){var t,e="";for(t in dataUnit[this.id])e+=dataUnit[this.id][t]+"\n";setValueToElement(this,e)};e=fabricaStandard("textarea",t,{"data!":c,onchange:d});break;case"t":var c=function(){for(var t,e,n,a,i,o=dataUnit[this.id];this.hasChildNodes();)this.removeChild(this.firstChild);t=document.createElement("table"),t.id=this.id+"-table";for(a in o){e=document.createElement("tr");for(i in o[a])n=document.createElement("0"===a?"th":"td"),setValueToElement(n,o[a][i]),e.appendChild(n);t.appendChild(e)}this.appendChild(t)};e=fabricaSimpleTable(t,{"data!":c});break;case"c":case"r":case"k":case"i":var f=[],g=[];for(var v in dataUnit[t])"0"!==v&&(g.push(dataUnit[t][v][0]||"?"),f.push(dataUnit[t][v][1]||"?"));var p=dataUnit[t+" orientation"]||"X";"c"==t.charAt(0)&&corpiny.appendChild(fabricaSelect(t,g,f,!1)),"i"==t.charAt(0)&&corpiny.appendChild(fabricaSelect(t,g,f,!0)),"r"==t.charAt(0)&&corpiny.appendChild(fabricaGrupo("radio",p,t,g,f)),"k"==t.charAt(0)&&corpiny.appendChild(fabricaGrupo("checkbox",p,t,g,f))}e&&(javajzWidgets[t]=e,corpiny.appendChild(e),updatezWidget(e))}}function getzWidgetByName(t){return javajzWidgets[t]}function updatezWidget(t){t&&(t["data!"]?t["data!"]():alert("ERROR (updateWidget) zwidget /"+t.id+"/ with no 'data!' message"))}function str2jsVar(str){var str2="";if("string"!=typeof str)for(var ii=0;ii<str.length;ii++)str2=(0===ii?"":str2+"\n")+str[ii];else str2=str;return str2.match(/^\s*[\"\']/)?str2.substr(1):str2.match(/^\s*[\[\{]/)?eval("(function () { return "+str2+";}) ()"):function(){eval(str2)}}function fabricaStandard(t,e,n){var a=document.createElement(t);a.id=e,a.style.visibility="hidden",a.spellcheck=!1;for(var i in n)a[i]=n[i];"input"!==t||dataUnit[e]||(dataUnit[e]=[[""]]);for(var o in dataUnit)if(o.startsWith(e+" ")){var r=o.substr(e.length+1),d=dataUnit[o];a[r]=str2jsVar(d)}return a}function fabricaCombo(t,e,n){return fabricaSelect(t,e,n,!1)}function fabricaList(t,e,n){return fabricaSelect(t,e,n,!0)}function fabricaSelect(t,e,n,a){var i=document.createElement("select");a&&(i.multiple="si"),i.id=t,i.style.visibility="hidden",i.onchange=function(){mensaka(t)};for(var o in e){var r=document.createElement("option");r.value=e[o],r["data!"]=function(){},r.appendChild(document.createTextNode(n[o])),i.appendChild(r)}return i}function fabricaGrupo(t,e,n,a,i){var o=document.createElement("div");o.id=n,o.style.visibility="hidden",o.onchange=function(){mensaka(n)};for(var r in a){var d=document.createElement("input");d.type=t,d.name=n,d.value=a[r],d.label=i[r],d["data!"]=function(){},d.onchange=function(){dataUnit[n+" selected.value"]=[[this.value||"?"]],dataUnit[n+" selected.label"]=[[this.label||"?"]],dataUnit[n+"_value"]=[[this.value||"?"]]},"0"===r||"Y"!=e&&"V"!=e||o.appendChild(document.createElement("br")),o.appendChild(d),o.appendChild(document.createTextNode(i[r]))}return o}function fabricaSimpleTable(t,e){var n=document.createElement("div");n.id=t,n.widgetype="t",n.style.visibility="hidden";for(var a in e)n[a]=e[a];return n}function jaxGetHttpReq(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void alert("Your browser does not support AJAX!")}function startsWith(t,e){return t.slice(0,e.length)===e}function jaxDefaultResponseFunc(t,e){var n="unitAjaxResponse";responseAjaxUnit=startsWith(t,"#"+n+"#")?evaFileStr2obj(t)[n]||{}:{"ajaxRESP-rawBody":[[t]]};var a,i=1;do a=e.getResponseHeader("ajaxRESP-parameter"+i),a&&(responseAjaxUnit["ajaxRESP-parameter"+i]=[[a]]),i++;while(a)}function AJAXFormatBody(t,e,n,a){function i(t){return!a&&dataUnit[e[t]]&&1==dataUnit[e[t]].length&&1==dataUnit[e[t]][0].length?[[encodeURIComponent(dataUnit[e[t]])]]:dataUnit[e[t]]||""}var o;if(n=n||"eva",!e){e=[];for(var r in dataUnit)e.push(r)}var d="";if("propval"===n)for(o in e)d+="\n"+e[o]+":"+i(o);else if("json"===n){d="{";for(o in e)d+="'"+e[o]+"' : '"+i(o)+"', ";d+="}"}else if("eva"===n){var s=evaFileObj("#unitAjaxRequest#\n   <_jGastonaVersion> 1.0\n"),u=s.obj.unitAjaxRequest;for(o in e)u[e[o]]=i(o);d=s.toText()}else alert("ERROR: calling AJAXFormatBody with not supported format ["+n+"]");return d}function ajaxGenericPreProcessResponse(){}function AJAXgenericPost(t,e,n,a){var i=jaxGetHttpReq();if(!i)return!1;if(a||(a=jaxDefaultResponseFunc),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(ajaxGenericPreProcessResponse(i),a(i.responseText,i),mensaka("ajaxResponse "+t))},i.open("POST",t,!0),n)for(var o in n)i.setRequestHeader(o,n[o]);i.send(e)}function AJAXSendData(t,e,n,a){var i="string"==typeof e?e:AJAXFormatBody(t,e,n,a);AJAXgenericPost(t,i)}function AJAXUploadFile(t,e,n){var a=t.files[0];if(!a||""===a)return!1;var i=new FormData;i.append("filename",a),AJAXgenericPost(e,i,n)}function AJAXLoadRootJast(t){AJAXgenericPost("loadRootJast","",{"ajaxREQ-jastName":t},function(t){loadJast(evaFileStr2obj(t))})}function setContentsFromBody(t,e,n){var a="";if(n){for(var i=e.split("\n"),o=0;o<i.length;){var r=/([^:]*):(.*)/.exec(i[o++]);if(r){if(""===r[1])break;setData(r[1],r[2])}}for(var d=o;d<i.length;d++)a=a+(d!=o?"\n":"")+i[d]}else a=e;var s=document.getElementById(t);s&&setValueToElement(s,a)}function AJAXgetIdContent(t,e,n){var a="string"==typeof e?{"ajaxREQ-param":e}:e||{};a["ajaxREQ-id"]=t,AJAXgenericPost("getIdContent","",a,function(e){setContentsFromBody(t,e,n)})}function AJAXgetIdMultipleContents(t,e){AJAXgetIdContent(t,e,!0)}var dataUnit,listixUnit,corpiny,layMan,responseAjaxUnit,javajzWidgets,minWidth=-1,minHeight=-1;return loadJast(evaConfig),document.body.onresize=function(){adaptaLayout()},{getLayoutMan:function(){return layMan},mensaka:mensaka,getIdValue:function(t){var e=document.getElementById(t);return e?e.value:getDataCell(t)},getData:getDataCell,setData:setData,setVarTable_DimVal:setVarTable_DimVal,getCellEvaUnit:getCellEvaUnit,adapta:adaptaLayout,mask:function(t,e){layMan&&(layMan.maskLayoutId(t,e),adaptaLayout())},unmask:function(t){layMan&&(layMan.unmaskLayoutId(t),adaptaLayout())},getAjaxResponse:function(){return responseAjaxUnit},AJAXPost:AJAXgenericPost,AJAXSendData:AJAXSendData,AJAXSendBody:AJAXSendData,AJAXUploadFile:AJAXUploadFile,AJAXLoadRootJast:AJAXLoadRootJast,AJAXgetIdContent:AJAXgetIdContent,AJAXgetIdMultipleContents:AJAXgetIdMultipleContents}}