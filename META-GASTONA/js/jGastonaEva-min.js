/*
jGastonaEva-min.js = minify Eva.js + EvaLayout.js + LayoutManager.js + jGastona.js
is part of the open source project https://github.com/wakeupthecat/gastona

Copyright (C) 2015,2016 Alejandro Xalabarder Aulet
License : GNU General Public License (GPL) version 3

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.
*/

"use strict";function evaFileObj(t){function e(t){var e,i="";for(e in t)i+="\n#"+e+"#\n",i+=n(t[e]);return i}function n(t){var e,n="";for(e in t)n+="\n   <"+e+">\n",n+=i(t[e]);return n}function i(t){var e="";for(var n in t){e+="      ";for(var i in t[n])i>0&&(e+=", "),i==t[n].length-1&&(e+="//"),e+=t[n][i];e+="\n"}return e}return"string"==typeof t&&(t=evaFileStr2obj(t)),{obj:t,toText:function(){return e(t)},toString:function(){return e(t)},evaFileObj2Text:e,evaUnitObj2Text:n,evaObj2Text:i}}function evaFile(t){alert("evaFile function name is deprecated! please use evaFileStr2obj instead"),evaFileStr2obj(t)}function evaFileUTF82obj(t){return evaFileStr2obj(decodeURIComponent(t.replace(/\+/g,"%20")))}function evaFileStr2obj(t){function e(t,e,n){if(0==t.indexOf(e)){var i=t.indexOf(n,1);return i>0?{name:t.substr(1,i-1),rest:t.substr(i+1).trim()}:void 0}}function n(t,e,n,i){if(t=t.trim(),e=t.length,0!=e){if(0==t.indexOf("'"))return[t.substr(1)];if(0==t.indexOf("//"))return[t.substr(2)];t.lastIndexOf(",")==e-1&&(t=t.substring(0,e-1)),n=t.split(",");for(i in n)n[i]=decodeURIComponent(n[i].trim());return n}}function i(t){function i(t){o&&(c[o]=g),o=void 0,g=[],t&&(a&&(l[a]=c),a=void 0,c=[])}var a,o,r,u,d,s,f,l={},c={},g=[],d=t;"string"==typeof t&&(d=t.split("\n"));for(f in d)u=d[f].trim(),r=e(u,"#","#"),r?(i(!0),a=r.name):(r=e(u,"<",">"),r&&(i(!1),o=r.name,u=r.rest,0==u.length)||a&&o&&(s=n(u),s&&g.push(s)));return i(!0),l}return"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),i(t)}function EvaLayout(t,e){function n(t,e){function n(t){var e=d,n=0,i=0;return t+="",0==t.length||0==t.indexOf(g)?e=d:0==t.indexOf(v)?(e=s,n=t.length<2?1:parseInt(t.substr(1))):(e=u,i=parseInt(t)),{type:e,len:i,extraPercent:n}}function i(t,e){e=n(t||""),c.push(e),f+=e.extraPercent}function a(t,e){c[t]&&c[t].type==d&&(c[t].len=Math.max(c[t].len,e))}function o(n,i){l=t+t+e*(c.length-1);for(n in c)i=c[n],l+=i.len,f>0&&(i.extraPercent=i.extraPercent/f)}function r(t,n,i,a){for(a=0,i=i||n;(i>=n||-1==i)&&n<c.length;n++)a+=e+c[n].len+c[n].extraPercent*t;return a}var u=0,d=1,s=2,f=0,l=0,c=[];return{margin:t,gap:e,fixedSize:function(){return l},regla:c,addItem:i,setLengthOfItemAt:a,endItems:o,getLengthInRange:r,countItems:function(){return c.length}}}function i(t){return y[1][t+1]}function a(t){return y[2+t][0]}function o(){return y.length-2}function r(t){return y[2+t].length-1}function u(t,e){return t+=2,e+=1,t>=0&&t<y.length&&e>=0&&e<y[t].length?y[t][e]:void 0}function d(){if(!h){l=n(parseInt(y[0][1])||0,parseInt(y[0][3])||0),c=n(parseInt(y[0][2])||0,parseInt(y[0][4])||0);for(var e=0,d=o(),s=0;d>s;s++){e=r(s),c.addItem(a(s));for(var f=0;e>f;f++){f<l.countItems()||l.addItem(i(f));var g=u(s,f);if(g){var v=t.getLayableByName(g);if(v){v.indxPos.ileft=f,v.indxPos.itop=s;for(var x=f;e>x+1&&u(s,x+1)===m;)x++;for(e>x+1&&u(s,x+1)===m+m&&(x=-1),v.indxPos.iright=x,x==f&&l.setLengthOfItemAt(f,v.iniRect.right-v.iniRect.left),x=s;d>x+1&&u(x+1,f)===p;)x++;d>x+1&&u(x+1,f)===p+p&&(x=-1),v.indxPos.ibottom=x,x==s&&c.setLengthOfItemAt(s,v.iniRect.bottom-v.iniRect.top),v.isLaidOut=!0}}}}l.endItems(),c.endItems(),b.top=0,b.bottom=c.fixedSize(),b.left=0,b.right=l.fixedSize(),h=!0}}function s(e,n,i,a){d();for(var o=a-c.fixedSize(),r=i-l.fixedSize(),s=e+l.margin,f=0;f<l.countItems();f++){f>0&&(s+=l.getLengthInRange(r,f-1));for(var g=n+c.margin,v=0;v<c.countItems();v++){v>0&&(g+=c.getLengthInRange(o,v-1));var m=u(v,f);if(m){var p=t.getLayableByName(m);if(p)if(p.isLaidOut){var h=-l.gap,y=-c.gap;if(h+=l.getLengthInRange(r,p.indxPos.ileft,p.indxPos.iright),y+=c.getLengthInRange(o,p.indxPos.itop,p.indxPos.ibottom),0>s||0>g||0>h||0>y)continue;p.doMove(s,g,h,y),p.doShow(!0)}else p.doShow(!1)}}}}function f(e){d();for(var n=0;n<l.countItems();n++)for(var i=0;i<c.countItems();i++){var a=t.getLayableByName(u(i,n));a&&a.doShow(e)}}var l,c,g="A",v="X",m="-",p="+",h=!1,y=t.guiLayouts[e],b={left:0,right:200,top:0,bottom:20},x={ileft:0,iright:0,itop:0,ibottom:0};return y?y[0][0].match(/^eva$|^evalayout$/i)?{precalculateLayout:d,wName:e,isLaidOut:!1,iniRect:b,indxPos:x,invalidate:function(){h=!1},isWidget:!1,doMove:s,doShow:f}:void 0:void console.log('ERROR: no eva found with name "'+e+'"')}function layoutManager(t,e){function n(t,e,n){for(n in t)if(t[n]===e)return console.log("ERROR: layout element "+e+" already exists, it cannot be stacked!"),!1;return!0}function i(t){h&&h===t||a(),h=t}function a(t,e){for(e in I)t=I[e],t.isWidget?t.doShow(!1):t.invalidate()}function o(t,e){return{wName:t,isLaidOut:!1,iniRect:e||{left:0,right:200,top:0,bottom:20},indxPos:{ileft:0,iright:0,itop:0,ibottom:0},isWidget:!0,doMove:function(e,n,i,a){var o=document.getElementById(t);o?(o.style.position="absolute",o.style.left=Math.round(e)+"px",o.style.top=Math.round(n)+"px",o.style.width=Math.round(i)+"px",o.style.height=Math.round(a)+"px"):console.log("ERROR expected html element "+t+" not found!")},doShow:function(e){var n=document.getElementById(t);n&&(n.style.visibility=e?"visible":"hidden")}}}function r(t){if(""!==t&&f(t)){var e=I[s(t)];return e?(n(x,e.wName)&&(e.isWidget||e.precalculateLayout()),e):(console.log("ERROR: don't know how to find "+t+" or "+s(t)),o("bDummy"))}}function u(t,e){b[t]=e&&""!==e&&t!==e?e:void 0,p=!0,a()}function d(t){b[t]=void 0,p=!0,a()}function s(t){var e,n,i=[];if(!f(t))return t;do{if(e=b[t],!e||""===e||e===t)return t;for(n in i)if(i[n]===e)return console.log("ERROR: masks for "+t+" found circular!"),t;i.push(t),t=e}while(i.length<200);return console.log("ERROR: masks for "+t+" too deep!"),t}function f(t){return t&&0!=t.length?t.match(/^[^+-]/):!1}function l(){return{guiLayouts:v,guiConfig:m,getLayableByName:r}}function c(t){if(m={},v=t.layouts,!v){v={};var e=t.javaj;if(!e)return void console.log("Error: unit layouts not found!");for(var n in e)0==n.indexOf("layout of ")?v[n.substr(10)]=e[n]:m[n]=e[n]}p=!0,b={},x=[],I={};for(var i in v){var a=EvaLayout(l(),i);a&&(I[i]=a,console.log("adding layout id ["+i+"]"))}var n,r,u,d,s,c;for(i in v){n=v[i],u=n.length;for(var r=2;u>r;r++){s=n[r].length;for(var d=1;s>d;d++)c=n[r][d],f(c)&&(I[c]||(y(c),I[c]=o(c)))}}}function g(t,e,n,a,o){t=t||"main",i(t);var u=r(t);u&&(x.push(u.wName),u.doMove(e,n,a,o),x.pop())}var v,m,p,h,y=e||function(t){console.log("adding widget id ["+t+"]")},b={},x=[],I={};return c(t),{guiConfig:m,loadConfig:function(e){t=e,c(t)},maskLayoutId:u,unmaskLayoutId:d,doShowLayout:function(t,e,n){g(t,0,0,e,n)},setLayout:function(t){i(t)},doLayout:function(t,e){g(h,0,0,t,e)}}}function jGastona(evaConfig,existingPlaceId){function getWindowWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getWindowHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function strStartsWith(t,e,n){return n=n||0,t.indexOf(e,n)===n}function htmlElem(t){return"string"==typeof t?document.getElementById(t):t}function adaptaLayout(){if(layMan){var t=getWindowWidth()-15,e=getWindowHeight()-15,n=layMan.guiConfig.layoutWindowLimits;if(n&&n[0]){var i=parseInt("0"|n[0][0]),a=parseInt("0"|n[0][1]),o=parseInt("0"|n[0][2]),r=parseInt("0"|n[0][3]);t=Math.max(t,i),e=Math.max(e,a),o>0&&(t=Math.min(t,o)),r>0&&(e=Math.min(e,r))}layMan&&layMan.doLayout(t,e)}}function loadJast(t){if(javajzWidgets={},responseAjaxUnit={},dataUnit={},listixUnit={},layMan=void 0,t){if(dataUnit=t.data||{},listixUnit=t.listix||{},!corpiny){var e=existingPlaceId?existingPlaceId:"jGastonaStammHtmlElem";document.getElementById(e)||(document.body.innerHTML="<div id='"+e+"' style = 'position:relative;'></div>"),corpiny=document.getElementById(e)}for(corpiny||alert("ERROR no "+e+" no fun!");corpiny.hasChildNodes();)corpiny.removeChild(corpiny.firstChild);layMan=layoutManager(t,onAddWidget),adaptaLayout()}}function getCellEvaUnit(t,e,n,i){return t[e]?t[e][n||"0"][i||"0"]||"":""}function getDataCell(t,e,n){return getCellEvaUnit(dataUnit,t,e,n)}function setDataCell(t,e,n,i){dataUnit[t]||(dataUnit[t]=[[""]]),dataUnit[t][n||"0"]||(dataUnit[t][n||"0"]=[""]),dataUnit[t][n||"0"][i||"0"]=e||""}function setData(t,e){"string"==typeof e?setDataCell(t,e):Array.isArray(e)&&e.length>0&&Array.isArray(e[0])?dataUnit[t]=e:alert('Error: setData "'+t+'", the value is not a string nor looks like an eva variable');var n=getzWidgetByName(t);n&&updatezWidget(n)}function mensaka(t){var e=t.indexOf(" ");if(e>0){var n=t.substr(0,e),i=t.substr(e+1);if(javajzWidgets[n])return void(javajzWidgets[n][i]?javajzWidgets[n][i]():console.log("Error: widget "+n+" has no method '"+i+"'"))}var a=dataUnit["-- "+t]||listixUnit["-- "+t];return a?void executeListixFormat(a):void console.log('ignoring mensaka "'+t+'"')}function executeListixFormat(fbody){var strBody="";for(var ii in fbody)strBody+=fbody[ii]+"\n";eval(strBody)}function setVarTable_DimVal(t){var e=[["dimension","value"]];for(var n in t)e.push([t[n],getDataCell(t[n])]);dataUnit.varTable_DimVal=e}function setValueToElement(t,e){t&&("string"==typeof t.value?t.value=e:t.innerHTML=e)}function onAddWidget(t){if(t&&0!=t.length){var e,n=function(){this.innerHTML=dataUnit[t]?getDataCell(t):t.substr(1)},i=function(){setValueToElement(this,getDataCell(t))},a=function(){this.value=""},o=function(){this.style["background-image"]="url('"+getDataCell(t)+"')"},r=function(){dataUnit[t][0]=[this.value||"?"]},u=function(){dataUnit[t]=[[]];var e=this.value||"?",n=e.split("\n");for(var i in n)dataUnit[t][i]=[n[i]]},d=function(){mensaka(t)},s=dataUnit["class of "+t],f=s?s[0][0]:t;switch(f.charAt(0)){case"d":e=fabricaStandard("div",t,{"data!":n});break;case"n":e=fabricaStandard("a",t,{href:"login","data!":n});break;case"b":e=fabricaStandard("button",t,{onclick:d,"data!":n});break;case"e":e=fabricaStandard("input",t,{type:"text",onchange:r,"data!":i});break;case"u":e=fabricaStandard("input",t,{type:"file",onchange:d,"data!":a});break;case"m":e=fabricaStandard("div",t,{"data!":o}),e.style["background-position"]="center center",e.style["background-repeat"]="no-repeat",e.style["background-size"]="contain";break;case"p":e=fabricaStandard("input",t,{type:"password",onchange:r,"data!":i});break;case"l":e=fabricaStandard("label",t,{"data!":n});break;case"x":var l=function(){var t,e="";for(t in dataUnit[this.id])e+=dataUnit[this.id][t]+"\n";setValueToElement(this,e)};e=fabricaStandard("textarea",t,{"data!":l,onchange:u});break;case"t":var l=function(){for(var t,e,n,i,a,o=dataUnit[this.id];this.hasChildNodes();)this.removeChild(this.firstChild);t=document.createElement("table"),t.id=this.id+"-table";for(i in o)if("0"===i&&1==o[0].length&&""===o[0][0]);else{e=document.createElement("tr");for(a in o[i])n=document.createElement("0"===i?"th":"td"),setValueToElement(n,o[i][a]),e.appendChild(n);t.appendChild(e)}this.appendChild(t)};e=fabricaSimpleTable(t,{"data!":l});break;case"c":case"r":case"k":case"i":var c=[],g=[];for(var v in dataUnit[t])"0"!==v&&(g.push(dataUnit[t][v][0]||"?"),c.push(dataUnit[t][v][1]||"?"));var m=dataUnit[t+" orientation"]||"X";"c"==t.charAt(0)&&corpiny.appendChild(fabricaSelect(t,g,c,!1)),"i"==t.charAt(0)&&corpiny.appendChild(fabricaSelect(t,g,c,!0)),"r"==t.charAt(0)&&corpiny.appendChild(fabricaGrupo("radio",m,t,g,c)),"k"==t.charAt(0)&&corpiny.appendChild(fabricaGrupo("checkbox",m,t,g,c))}e&&(javajzWidgets[t]=e,corpiny.appendChild(e),updatezWidget(e),dataUnit[t]||(dataUnit[t]=[[""]]))}}function getzWidgetByName(t){return javajzWidgets[t]}function updatezWidget(t){t&&(t["data!"]?t["data!"]():alert("ERROR (updateWidget) zwidget /"+t.id+"/ with no 'data!' message"))}function str2jsVar(str){var str2="";if("string"!=typeof str)for(var ii=0;ii<str.length;ii++)str2=(0===ii?"":str2+"\n")+str[ii];else str2=str;return str2.match(/^\s*[\"\']/)?str2.substr(1):str2.match(/^\s*[\[\{]/)?eval("(function () { return "+str2+";}) ()"):function(){eval(str2)}}function fabricaStandard(t,e,n){var i=document.createElement(t);i.id=e,i.style.visibility="hidden",i.spellcheck=!1;for(var a in n)i[a]=n[a];"input"!==t||dataUnit[e]||(dataUnit[e]=[[""]]);for(var o in dataUnit)if(strStartsWith(o,e+" ")){var r=o.substr(e.length+1),u=dataUnit[o];i[r]=str2jsVar(u)}return i}function fabricaCombo(t,e,n){return fabricaSelect(t,e,n,!1)}function fabricaList(t,e,n){return fabricaSelect(t,e,n,!0)}function selectAllColumnsFromTable(t,e,n){if(t&&t[e]&&t[e][0])for(var i=t[e][0],a=1;a<t[e].length;a++)if(t[e][a][0]==n)for(var o in i)t[e+" selected."+i[o]]=[[t[e][a][o]||"?"]]}function fabricaSelect(t,e,n,i){var a=document.createElement("select");i&&(a.multiple="si"),a.id=t,a.style.visibility="hidden",a.onchange=function(){selectAllColumnsFromTable(dataUnit,t,this.value||"?"),dataUnit[t+"_value"]=[[this.value||"?"]],mensaka(t)};for(var o in e){var r=document.createElement("option");r.value=e[o],r["data!"]=function(){},r.appendChild(document.createTextNode(n[o])),a.appendChild(r)}return a}function fabricaGrupo(t,e,n,i,a){var o=document.createElement("div");o.id=n,o.style.visibility="hidden",o.onchange=function(){mensaka(n)};for(var r in i){var u=document.createElement("input");u.type=t,u.name=n,u.value=i[r],u.label=a[r],u["data!"]=function(){},u.onchange=function(){dataUnit[n+" selected.value"]=[[this.value||"?"]],dataUnit[n+" selected.label"]=[[this.label||"?"]],dataUnit[n+"_value"]=[[this.value||"?"]]},"0"===r||"Y"!=e&&"V"!=e||o.appendChild(document.createElement("br")),o.appendChild(u),o.appendChild(document.createTextNode(a[r]))}return o}function fabricaSimpleTable(t,e){var n=document.createElement("div");n.id=t,n.widgetype="t",n.style.visibility="hidden";for(var i in e)n[i]=e[i];return n}function canUploadFile(t,e,n,i){var a=htmlElem(t),o=a.files[0],r=e;return o&&""!==o?r&&r>0&&o.size>1024*r*1024?(""!==i&&alert(i?i:"File is too big to be uploaded, limit is "+e+" MB"),!1):!0:(""!==n&&alert(n?n:"Please choose first a file!"),!1)}function jaxGetHttpReq(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void alert("Your browser does not support AJAX!")}function jaxDefaultResponseFunc(t,e){var n="unitAjaxResponse";responseAjaxUnit=strStartsWith(t,"#"+n+"#")?evaFileStr2obj(t)[n]||{}:{"ajaxRESP-rawBody":[[t]]};var i,a=1;do i=e.getResponseHeader("ajaxRESP-parameter"+a),i&&(responseAjaxUnit["ajaxRESP-parameter"+a]=[[i]]),a++;while(i)}function AJAXFormatBody(t,e,n,i){function a(t){return!i&&dataUnit[e[t]]&&1==dataUnit[e[t]].length&&1==dataUnit[e[t]][0].length?[[encodeURIComponent(dataUnit[e[t]])]]:dataUnit[e[t]]||""}var o;if(n=n||"eva",!e){e=[];for(var r in dataUnit)e.push(r)}var u="";if("propval"===n)for(o in e)u+="\n"+e[o]+":"+a(o);else if("json"===n){u="{";for(o in e)u+="'"+e[o]+"' : '"+a(o)+"', ";u+="}"}else if("eva"===n){var d=evaFileObj("#unitAjaxRequest#\n"),s=d.obj.unitAjaxRequest;for(o in e)s[e[o]]=a(o);u=d.toText()}else alert("ERROR: calling AJAXFormatBody with not supported format ["+n+"]");return u}function ajaxGenericPreProcessResponse(){}function AJAXgenericPost(t,e,n,i){var a=jaxGetHttpReq();if(!a)return!1;if(i||(i=jaxDefaultResponseFunc),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&(ajaxGenericPreProcessResponse(a),i(a.responseText,a),mensaka("ajaxResponse "+t))},a.open("POST",t,!0),n)for(var o in n)a.setRequestHeader(o,n[o]);a.send(e||"")}function AJAXSendData(t,e,n,i){var a="string"==typeof e?e:AJAXFormatBody(t,e,n,i);AJAXgenericPost(t,a)}function AJAXUploadFile(t,e,n){if(!t)return!1;var i=htmlElem(t),a=i.files[0];if(!a||""===a)return!1;var o=new FormData;o.append("filename",a),AJAXgenericPost(e,o,n)}function AJAXLoadRootJast(t){AJAXgenericPost("loadRootJast","",{"ajaxREQ-jastName":t},function(t){loadJast(evaFileStr2obj(t))})}function setContentsFromBody(t,e,n){var i="";if(n){for(var a=e.split("\n"),o=0;o<a.length;){var r=/([^:]*):(.*)/.exec(a[o++]);if(r){if(""===r[1])break;setData(r[1],r[2])}}for(var u=o;u<a.length;u++)i=i+(u!=o?"\n":"")+a[u]}else i=e;var d=document.getElementById(t);d&&setValueToElement(d,i)}function AJAXgetIdContent(t,e,n){var i="string"==typeof e?{"ajaxREQ-param":e}:e||{};i["ajaxREQ-id"]=t,AJAXgenericPost("getIdContent","",i,function(e){setContentsFromBody(t,e,n)})}function AJAXgetIdMultipleContents(t,e){AJAXgetIdContent(t,e,!0)}var dataUnit,listixUnit,corpiny,layMan,responseAjaxUnit,javajzWidgets,minWidth=-1,minHeight=-1;return loadJast(evaConfig),document.body.onresize=function(){adaptaLayout()},{getLayoutMan:function(){return layMan},mensaka:mensaka,getIdValue:function(t){var e=document.getElementById(t);return e?e.value:getDataCell(t)},getData:getDataCell,setData:setData,setVarTable_DimVal:setVarTable_DimVal,getCellEvaUnit:getCellEvaUnit,adapta:adaptaLayout,mask:function(t,e){layMan&&(layMan.maskLayoutId(t,e),adaptaLayout())},unmask:function(t){layMan&&(layMan.unmaskLayoutId(t),adaptaLayout())},htmlElem:htmlElem,canUploadFile:canUploadFile,getAjaxResponse:function(){return responseAjaxUnit},AJAXPost:AJAXgenericPost,AJAXSendData:AJAXSendData,AJAXSendBody:AJAXSendData,AJAXUploadFile:AJAXUploadFile,AJAXLoadRootJast:AJAXLoadRootJast,AJAXgetIdContent:AJAXgetIdContent,AJAXgetIdMultipleContents:AJAXgetIdMultipleContents}}