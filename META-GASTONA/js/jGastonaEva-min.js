/*
jGastonaEva-min.js = minify Eva.js + EvaLayout.js + LayoutManager.js + jGastona.js
is part of the open source project https://github.com/wakeupthecat/gastona

Copyright (C) 2015,2016,2017 Alejandro Xalabarder Aulet
License : GNU General Public License (GPL) version 3

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.
*/
"use strict";function evaFileObj(n){function t(n){var t,r="";for(t in n)r+="\n#"+t+"#\n",r+=e(n[t]);return r}function e(n){var t,e="";for(t in n)e+="\n   <"+t+">\n",e+=r(n[t]);return e}function r(n){var t="";for(var e in n){t+="      ";for(var r in n[e])r>0&&(t+=", "),r==n[e].length-1&&(t+="//"),t+=n[e][r];t+="\n"}return t}return"string"==typeof n&&(n=evaFileStr2obj(n)),{obj:n,toText:function(){return t(n)},toString:function(){return t(n)},evaFileObj2Text:t,evaUnitObj2Text:e,evaObj2Text:r}}function evaFile(n){alert("evaFile function name is deprecated! please use evaFileStr2obj instead"),evaFileStr2obj(n)}function evaFileUTF82obj(n){return evaFileStr2obj(decodeURIComponent(n.replace(/\+/g,"%20")))}function evaFileStr2obj(n){function t(n,t,e){if(0==n.indexOf(t)){var r=n.indexOf(e,1);return r>0?{name:n.substr(1,r-1),rest:n.substr(r+1).trim()}:void 0}}function e(n,t,e,r){if(n=n.trim(),t=n.length,0!=t){if(0==n.indexOf("'"))return[n.substr(1)];if(0==n.indexOf("//"))return[n.substr(2)];n.lastIndexOf(",")==t-1&&(n=n.substring(0,t-1)),e=n.split(",");for(r in e)e[r]=decodeURIComponent(e[r].trim());return e}}function r(n){function r(n){o&&(l[o]=b.length>0?b:[[""]]),o=void 0,b=[],n&&(i&&(v[i]=l),i=void 0,l=[])}var i,o,u,f,a,s,c,v={},l={},b=[],a=n;"string"==typeof n&&(a=n.split("\n"));for(c in a)f=a[c].trim(),u=t(f,"#","#"),u?(r(!0),i=u.name):(u=t(f,"<",">"),u&&(r(!1),o=u.name,f=u.rest,0==f.length)||i&&o&&(s=e(f),s&&b.push(s)));return r(!0),v}return"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),r(n)}
function EvaLayout(t,e){function n(t,e){function n(t){var e=f,n=0,i=0;return t+="",0==t.length||0==t.indexOf(l)?e=f:0==t.indexOf(v)?(e=s,n=t.length<2?1:parseInt(t.substr(1))):(e=u,i=parseInt(t)),{type:e,len:i,extraPercent:n}}function i(t,e){e=n(t||""),d.push(e),c+=e.extraPercent}function r(t,e){d[t]&&d[t].type==f&&(d[t].len=Math.max(d[t].len,e))}function o(n,i){g=t+t+e*(d.length-1);for(n in d)i=d[n],g+=i.len,c>0&&(i.extraPercent=i.extraPercent/c)}function a(t,n,i,r){for(r=0,i=i||n;(i>=n||-1==i)&&n<d.length;n++)r+=e+d[n].len+d[n].extraPercent*t;return r}var u=0,f=1,s=2,c=0,g=0,d=[];return{margin:t,gap:e,fixedSize:function(){return g},regla:d,addItem:i,setLengthOfItemAt:r,endItems:o,getLengthInRange:a,countItems:function(){return d.length}}}function i(t){return x[1][t+1]}function r(t){return x[2+t][0]}function o(){return x.length-2}function a(t){return x[2+t].length-1}function u(t,e){return t+=2,e+=1,t>=0&&t<x.length&&e>=0&&e<x[t].length?x[t][e]:void 0}function f(){if(!p){g=n(parseInt(x[0][1])||0,parseInt(x[0][3])||0),d=n(parseInt(x[0][2])||0,parseInt(x[0][4])||0);for(var e=0,f=o(),s=0;f>s;s++){e=a(s),d.addItem(r(s));for(var c=0;e>c;c++){c<g.countItems()||g.addItem(i(c));var l=u(s,c);if(l){var v=t.getLayableByName(l);if(v){v.indxPos.ileft=c,v.indxPos.itop=s;for(var b=c;e>b+1&&u(s,b+1)===m;)b++;for(e>b+1&&u(s,b+1)===m+m&&(b=-1),v.indxPos.iright=b,b==c&&g.setLengthOfItemAt(c,v.iniRect.right-v.iniRect.left),b=s;f>b+1&&u(b+1,c)===h;)b++;f>b+1&&u(b+1,c)===h+h&&(b=-1),v.indxPos.ibottom=b,b==s&&d.setLengthOfItemAt(s,v.iniRect.bottom-v.iniRect.top),v.isLaidOut=!0}}}}g.endItems(),d.endItems(),I.top=0,I.bottom=d.fixedSize(),I.left=0,I.right=g.fixedSize(),p=!0}}function s(e,n,i,r){f();for(var o=r-d.fixedSize(),a=i-g.fixedSize(),s=e+g.margin,c=0;c<g.countItems();c++){c>0&&(s+=g.getLengthInRange(a,c-1));for(var l=n+d.margin,v=0;v<d.countItems();v++){v>0&&(l+=d.getLengthInRange(o,v-1));var m=u(v,c);if(m){var h=t.getLayableByName(m);if(h)if(h.isLaidOut){var p=-g.gap,x=-d.gap;if(p+=g.getLengthInRange(a,h.indxPos.ileft,h.indxPos.iright),x+=d.getLengthInRange(o,h.indxPos.itop,h.indxPos.ibottom),0>s||0>l||0>p||0>x)continue;h.doMove(s,l,p,x),h.doShow(!0)}else h.doShow(!1)}}}}function c(e){f();for(var n=0;n<g.countItems();n++)for(var i=0;i<d.countItems();i++){var r=t.getLayableByName(u(i,n));r&&r.doShow(e)}}var g,d,l="A",v="X",m="-",h="+",p=!1,x=t.guiLayouts[e],I={left:0,right:200,top:0,bottom:20},b={ileft:0,iright:0,itop:0,ibottom:0};return x?x[0][0].match(/^eva$|^evalayout$/i)?{precalculateLayout:f,wName:e,isLaidOut:!1,iniRect:I,indxPos:b,invalidate:function(){p=!1},isWidget:!1,doMove:s,doShow:c}:void 0:void console.log('ERROR: no eva found with name "'+e+'"')}
function layoutManager(t,n){"use strict";function e(t,n,e){for(e in t)if(t[e]===n)return console.log("ERROR: layout element "+n+" already exists, it cannot be stacked!"),!1;return!0}function o(t){p&&p===t||i(),p=t}function i(t,n){for(n in I)t=I[n],t.isWidget?t.doShow(!1):t.invalidate()}function r(t,n){return{wName:t,isLaidOut:!1,iniRect:n||{left:0,right:200,top:0,bottom:20},indxPos:{ileft:0,iright:0,itop:0,ibottom:0},isWidget:!0,doMove:function(n,e,o,i){var r=document.getElementById(t);r?(r.style.position="absolute",r.style.left=Math.round(n)+"px",r.style.top=Math.round(e)+"px",r.style.width=Math.round(o)+"px",r.style.height=Math.round(i)+"px"):console.log("ERROR expected html element "+t+" not found!")},doShow:function(n){var e=document.getElementById(t);e&&(e.style.visibility=n?"visible":"hidden")}}}function a(t){if(""!==t&&l(t)){var n=I[s(t)];return n?(e(b,n.wName)&&(n.isWidget||n.precalculateLayout()),n):(console.log("ERROR: don't know how to find "+t+" or "+s(t)),r("bDummy"))}}function u(t,n){x[t]=n&&""!==n&&t!==n?n:void 0,h=!0,i()}function f(t){x[t]=void 0,h=!0,i()}function s(t){var n,e,o=[];if(!l(t))return t;do{if(n=x[t],!n||""===n||n===t)return t;for(e in o)if(o[e]===n)return console.log("ERROR: masks for "+t+" found circular!"),t;o.push(t),t=n}while(o.length<200);return console.log("ERROR: masks for "+t+" too deep!"),t}function l(t){return t&&0!=t.length?t.match(/^[^+-]/):!1}function d(){return{guiLayouts:v,guiConfig:m,getLayableByName:a}}function c(t){if(m={},v=t.layouts,!v){v={};var n=t.javaj;if(!n)return void console.log("Error: unit layouts not found!");for(var e in n)0==e.indexOf("layout of ")?v[e.substr(10)]=n[e]:m[e]=n[e]}h=!0,x={},b=[],I={};for(var o in v){var i=EvaLayout(d(),o);i&&(I[o]=i,console.log("adding layout id ["+o+"]"))}var e,a,u,f,s,c;for(o in v){e=v[o],u=e.length;for(var a=2;u>a;a++){s=e[a].length;for(var f=1;s>f;f++)c=e[a][f],l(c)&&(I[c]||(y(c),I[c]=r(c)))}}}function g(t,n,e,i,r){t=t||"main",o(t);var u=a(t);u&&(b.push(u.wName),u.doMove(n,e,i,r),b.pop())}var v,m,h,p,y=n||function(t){console.log("adding widget id ["+t+"]")},x={},b=[],I={};return c(t),{guiConfig:m,loadConfig:function(n){t=n,c(t)},maskLayoutId:u,unmaskLayoutId:f,doShowLayout:function(t,n,e){g(t,0,0,n,e)},setLayout:function(t){o(t)},doLayout:function(t,n){g(p,0,0,t,n)}}}
function jGastona(evaConfig,existingPlaceId){"use strict";function getWindowWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getWindowHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function strStartsWith(t,a,e){return e=e||0,t.indexOf(a,e)===e}function htmlElem(t){return"string"==typeof t?document.getElementById(t):t}function adaptaLayout(){if(layMan){var t=getWindowWidth()-15,a=getWindowHeight()-15,e=layMan.guiConfig.layoutWindowLimits;if(e&&e[0]){var n=parseInt("0"|e[0][0]),i=parseInt("0"|e[0][1]),r=parseInt("0"|e[0][2]),o=parseInt("0"|e[0][3]);t=Math.max(t,n),a=Math.max(a,i),r>0&&(t=Math.min(t,r)),o>0&&(a=Math.min(a,o))}layMan&&layMan.doLayout(t,a)}}function loadJast(t){if(javajzWidgets={},responseAjaxUnit={},dataUnit={},listixUnit={},layMan=void 0,t){if(dataUnit=t.data||{},listixUnit=t.listix||{},!corpiny){var a=existingPlaceId?existingPlaceId:"jGastonaStammHtmlElem";document.getElementById(a)||(document.body.innerHTML="<div id='"+a+"' style = 'position:relative;'></div>"),corpiny=document.getElementById(a)}for(corpiny||alert("ERROR no "+a+" no fun!");corpiny.hasChildNodes();)corpiny.removeChild(corpiny.firstChild);layMan=layoutManager(t,onAddWidget),adaptaLayout()}}function getCellEvaUnit(t,a,e,n){return t[a]?t[a][e||"0"][n||"0"]||"":""}function getDataCell(t,a,e){return getCellEvaUnit(dataUnit,t,a,e)}function setDataCell(t,a,e,n){dataUnit[t]||(dataUnit[t]=[[""]]),dataUnit[t][e||"0"]||(dataUnit[t][e||"0"]=[""]),dataUnit[t][e||"0"][n||"0"]=a||""}function setData(t,a){"string"==typeof a?setDataCell(t,a):Array.isArray(a)&&a.length>0&&Array.isArray(a[0])?dataUnit[t]=a:alert('Error: setData "'+t+'", the value is not a string nor looks like an eva variable');var e=getzWidgetByName(t);e&&updatezWidget(e)}function mensaka(t){var a=t.indexOf(" ");if(a>0){var e=t.substr(0,a),n=t.substr(a+1);if(javajzWidgets[e])return void(javajzWidgets[e][n]?javajzWidgets[e][n]():console.log("Error: widget "+e+" has no method '"+n+"'"))}var i=dataUnit["-- "+t]||listixUnit["-- "+t];return i?void executeListixFormat(i):void console.log('ignoring mensaka "'+t+'"')}function executeListixFormat(fbody){var strBody="";for(var ii in fbody)strBody+=fbody[ii]+"\n";eval(strBody)}function setVarTable_DimVal(t){var a=[["dimension","value"]];for(var e in t)a.push([t[e],getDataCell(t[e])]);dataUnit.varTable_DimVal=a}function setValueToElement(t,a){t&&("string"==typeof t.value?t.value=a:t.innerHTML=a)}function onAddWidget(t){function a(t){if(t.length<=2)return"";for(var a=t[1],e=2;e<t.length;e++)"_"==t[e]?a+=" ":(t[e]<"Z"&&" "!=a[a.length-1]&&(a+=" "),a+=t[e]);return a}if(t&&0!=t.length){var e,n=function(){this.innerHTML=dataUnit[t]?getDataCell(t):a(t)},i=function(){setValueToElement(this,getDataCell(t))},r=function(){this.value=""},o=function(){this.style["background-image"]="url('"+getDataCell(t)+"')"},d=function(){dataUnit[t][0]=[this.value||"?"]},l=function(){dataUnit[t]=[[]];var a=this.value||"?",e=a.split("\n");for(var n in e)dataUnit[t][n]=[e[n]]},s=function(){mensaka(t)},c=dataUnit["class of "+t],u=c?c[0][0]:t;switch(u.charAt(0)){case"d":e=fabricaStandard("div",t,{"data!":n});break;case"n":e=fabricaStandard("a",t,{href:"login","data!":n});break;case"b":e=fabricaStandard("button",t,{onclick:s,"data!":n});break;case"e":e=fabricaStandard("input",t,{type:"text",onchange:d,placeholder:a(t),"data!":i});break;case"u":e=fabricaStandard("input",t,{type:"file",onchange:s,"data!":r});break;case"m":e=fabricaStandard("div",t,{"data!":o}),e.style["background-position"]="center center",e.style["background-repeat"]="no-repeat",e.style["background-size"]="contain";break;case"p":e=fabricaStandard("input",t,{type:"password",placeholder:"password",onchange:d,"data!":i});break;case"l":e=fabricaStandard("label",t,{"data!":n});break;case"x":var f=function(){var t,a="";for(t in dataUnit[this.id])a+=dataUnit[this.id][t]+"\n";setValueToElement(this,a)};e=fabricaStandard("textarea",t,{placeholder:a(t),"data!":f,onchange:l});break;case"t":var f=function(){for(var t,a,e,n,i,r=dataUnit[this.id];this.hasChildNodes();)this.removeChild(this.firstChild);t=document.createElement("table"),t.id=this.id+"-table";for(n in r)if("0"===n&&1==r[0].length&&""===r[0][0]);else{a=document.createElement("tr");for(i in r[n])e=document.createElement("0"===n?"th":"td"),setValueToElement(e,r[n][i]),a.appendChild(e);t.appendChild(a)}this.appendChild(t)};e=fabricaSimpleTable(t,{"data!":f});break;case"c":case"r":case"k":case"i":var p=[],v=[];for(var m in dataUnit[t])"0"!==m&&(v.push(dataUnit[t][m][0]||"?"),p.push(dataUnit[t][m][1]||"?"));var h=dataUnit[t+" orientation"]||"X";"c"==t.charAt(0)&&corpiny.appendChild(fabricaSelect(t,v,p,!1)),"i"==t.charAt(0)&&corpiny.appendChild(fabricaSelect(t,v,p,!0)),"r"==t.charAt(0)&&corpiny.appendChild(fabricaGrupo("radio",h,t,v,p)),"k"==t.charAt(0)&&corpiny.appendChild(fabricaGrupo("checkbox",h,t,v,p))}e&&(javajzWidgets[t]=e,corpiny.appendChild(e),updatezWidget(e),dataUnit[t]||(dataUnit[t]=[[""]]))}}function getzWidgetByName(t){return javajzWidgets[t]}function updatezWidget(t){t&&(t["data!"]?t["data!"]():alert("ERROR (updateWidget) zwidget /"+t.id+"/ with no 'data!' message"))}function str2Var(str){var str2="";if("string"!=typeof str)for(var ii=0;ii<str.length;ii++)str2=(0===ii?"":str2+"\n")+str[ii];else str2=str;return str2.match(/^\s*[\"\']/)?str2.substr(1):str2.match(/^\s*[\[\{]/)?eval("(function () { return "+str2+";}) ()"):str2}function fabricaStandard(typestr,name,atts){var ele=document.createElement(typestr);ele.id=name,ele.style.visibility="hidden",ele.spellcheck=!1;for(var aa in atts)ele[aa]=atts[aa];"input"!==typestr||dataUnit[name]||(dataUnit[name]=[[""]]);for(var dd in dataUnit)if(strStartsWith(dd,name+" ")){var attrib=dd.substr(name.length+1),value=dataUnit[dd];strStartsWith(attrib,"on")?ele.addEventListener(attrib.substr(2),function(){eval(str2Var(value))}):"class"==attrib?ele.className=value:"+class"==attrib&&(ele.className+=" "+value),ele[attrib]=str2Var(value)}return ele}function fabricaCombo(t,a,e){return fabricaSelect(t,a,e,!1)}function fabricaList(t,a,e){return fabricaSelect(t,a,e,!0)}function selectAllColumnsFromTable(t,a,e){if(t&&t[a]&&t[a][0])for(var n=t[a][0],i=1;i<t[a].length;i++)if(t[a][i][0]==e)for(var r in n)t[a+" selected."+n[r]]=[[t[a][i][r]||"?"]]}function fabricaSelect(t,a,e,n){var i=document.createElement("select");n&&(i.multiple="si"),i.id=t,i.style.visibility="hidden",i.addEventListener("change",function(){selectAllColumnsFromTable(dataUnit,t,this.value||"?"),dataUnit[t+"_value"]=[[this.value||"?"]],mensaka(t)});for(var r in a){var o=document.createElement("option");o.value=a[r],o["data!"]=function(){},o.appendChild(document.createTextNode(e[r])),i.appendChild(o)}return i}function fabricaGrupo(t,a,e,n,i){var r=document.createElement("div");r.id=e,r.style.visibility="hidden",r.addEventListener("change",function(){mensaka(e)});for(var o in n){var d=document.createElement("input");d.type=t,d.name=e,d.value=n[o],d.label=i[o],d["data!"]=function(){},d.addEventListener("change",function(){dataUnit[e+" selected.value"]=[[this.value||"?"]],dataUnit[e+" selected.label"]=[[this.label||"?"]],dataUnit[e+"_value"]=[[this.value||"?"]]}),"0"===o||"Y"!=a&&"V"!=a||r.appendChild(document.createElement("br")),r.appendChild(d),r.appendChild(document.createTextNode(i[o]))}return r}function fabricaSimpleTable(t,a){var e=document.createElement("div");e.id=t,e.widgetype="t",e.style.visibility="hidden";for(var n in a)e[n]=a[n];return e}function canUploadFile(t,a,e,n){var i=htmlElem(t),r=i.files[0],o=a;return r&&""!==r?o&&o>0&&r.size>1024*o*1024?(""!==n&&alert(n?n:"File is too big to be uploaded, limit is "+a+" MB"),!1):!0:(""!==e&&alert(e?e:"Please choose first a file!"),!1)}function jaxGetHttpReq(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):void alert("Your browser does not support AJAX!")}function jaxDefaultResponseFunc(t,a){var e="unitAjaxResponse";responseAjaxUnit=strStartsWith(t,"#"+e+"#")?evaFileStr2obj(t)[e]||{}:{"ajaxRESP-rawBody":[[t]]};var n,i=1;do n=a.getResponseHeader("ajaxRESP-parameter"+i),n&&(responseAjaxUnit["ajaxRESP-parameter"+i]=[[n]]),i++;while(n)}function AJAXFormatBody(t,a,e,n){function i(t){return!n&&dataUnit[a[t]]&&1==dataUnit[a[t]].length&&1==dataUnit[a[t]][0].length?[[encodeURIComponent(dataUnit[a[t]])]]:dataUnit[a[t]]||""}var r;if(e=e||"eva",!a){a=[];for(var o in dataUnit)a.push(o)}var d="";if("propval"===e)for(r in a)d+="\n"+a[r]+":"+i(r);else if("json"===e){d="{";for(r in a)d+="'"+a[r]+"' : '"+i(r)+"', ";d+="}"}else if("eva"===e){var l=evaFileObj("#unitAjaxRequest#\n"),s=l.obj.unitAjaxRequest;for(r in a)s[a[r]]=i(r);d=l.toText()}else alert("ERROR: calling AJAXFormatBody with not supported format ["+e+"]");return d}function ajaxGenericPreProcessResponse(){}function AJAXgenericPost(t,a,e,n){var i=jaxGetHttpReq();if(!i)return!1;if(n||(n=jaxDefaultResponseFunc),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(ajaxGenericPreProcessResponse(i),n(i.responseText,i),mensaka("ajaxResponse "+t))},i.open("POST",t,!0),e)for(var r in e)i.setRequestHeader(r,e[r]);i.send(a||"")}function AJAXSendData(t,a,e,n){var i="string"==typeof a?a:AJAXFormatBody(t,a,e,n);AJAXgenericPost(t,i)}function AJAXUploadFile(t,a,e,n){if(!t)return!1;var i=htmlElem(t),r=i.files[0];if(!r||""===r)return!1;var o=new FormData;return o.append("filename",r),AJAXgenericPost(a,o,e,n),!0}function AJAXLoadRootJast(t){AJAXgenericPost("loadRootJast","",{"ajaxREQ-jastName":t},function(t){loadJast(evaFileStr2obj(t))})}function setContentsFromBody(t,a,e){var n="";if(e){for(var i=a.split("\n"),r=0;r<i.length;){var o=/([^:]*):(.*)/.exec(i[r++]);if(o){if(""===o[1])break;setData(o[1],o[2])}}for(var d=r;d<i.length;d++)n=n+(d!=r?"\n":"")+i[d]}else n=a;var l=document.getElementById(t);l&&setValueToElement(l,n)}function AJAXgetIdContent(t,a,e){var n="string"==typeof a?{"ajaxREQ-param":a}:a||{};n["ajaxREQ-id"]=t,AJAXgenericPost("getIdContent","",n,function(a){setContentsFromBody(t,a,e)})}function AJAXgetIdMultipleContents(t,a){AJAXgetIdContent(t,a,!0)}var dataUnit,listixUnit,corpiny,layMan,responseAjaxUnit,javajzWidgets,minWidth=-1,minHeight=-1;return loadJast(evaConfig),document.body.onresize=adaptaLayout,{getLayoutMan:function(){return layMan},mensaka:mensaka,getIdValue:function(t){var a=document.getElementById(t);return a?a.value:getDataCell(t)},getData:getDataCell,setData:setData,setVarTable_DimVal:setVarTable_DimVal,getCellEvaUnit:getCellEvaUnit,adapta:adaptaLayout,mask:function(t,a){layMan&&(layMan.maskLayoutId(t,a),adaptaLayout())},unmask:function(t){layMan&&(layMan.unmaskLayoutId(t),adaptaLayout())},htmlElem:htmlElem,canUploadFile:canUploadFile,getAjaxResponse:function(){return responseAjaxUnit},AJAXPost:AJAXgenericPost,AJAXSendData:AJAXSendData,AJAXSendBody:AJAXSendData,AJAXUploadFile:AJAXUploadFile,AJAXLoadRootJast:AJAXLoadRootJast,AJAXgetIdContent:AJAXgetIdContent,AJAXgetIdMultipleContents:AJAXgetIdMultipleContents}}
